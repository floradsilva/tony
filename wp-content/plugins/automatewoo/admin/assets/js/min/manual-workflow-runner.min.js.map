{"version":3,"sources":["manual-workflow-runner.js"],"names":["jQuery","$","Finder","Runner","ProgressBar","update","$el","progress","find","stop","animate","width","stopped","batchOffset","batchSize","possibleMatches","$matchesTable","$resultsContainer","$startButton","$stopButton","$step2","$step3","$workflowField","$noMatchesMessage","reset","empty","updateFoundCount","updateProgressBar","hide","updatePossibleMatchesCount","start","show","calculateQuickFilterResultsCount","count","findSet","post_data","action","workflow_id","val","offset","batch_size","post","ajaxurl","findSetResponse","response","success","i","data","results","length","complete","result","prepend","getFoundCount","text","getCurrentProgress","Math","round","callback","console","log","click","change","itemsToAddToQueue","itemsToAddCount","$log_adding","$log_added","prop","each","push","this","startAddToQueue","addBatchToQueue","completedAddingToQueue","batch","splice","queue_url"],"mappings":"AAIAA,OAAO,SAASC,GAEf,IAAIC,EAAS,GACTC,EAAS,GACTC,EAAc,CAElBC,OAAqB,SAAUC,EAAKC,GACnCD,EAAIE,KAAK,mDAAmDC,OAAOC,QAAS,CAC3EC,MAAOJ,EAAW,KACH,IAAbA,EAAiB,EAAI,OAGzBL,EAAOU,SAAU,EACjBV,EAAOW,YAAc,EACrBX,EAAOY,UAAY,GACnBZ,EAAOa,gBAAkB,EACzBb,EAAOc,cAAgBf,EAAE,6CACzBC,EAAOe,kBAAoBhB,EAAE,+CAC7BC,EAAOgB,aAAejB,EAAE,gDACxBC,EAAOiB,YAAclB,EAAE,+CACvBC,EAAOkB,OAASnB,EAAE,sCAClBC,EAAOmB,OAASpB,EAAE,sCAClBC,EAAOoB,eAAiBrB,EAAE,8CAC1BC,EAAOqB,kBAAoBtB,EAAE,kDAE7BC,EAAOsB,MAAQ,WACdtB,EAAOU,SAAU,EACjBV,EAAOW,YAAc,EACrBX,EAAOa,gBAAkB,EACzBb,EAAOe,kBAAkBQ,QACzBvB,EAAOwB,mBACPxB,EAAOyB,oBACPzB,EAAOmB,OAAOO,OACd1B,EAAOc,cAAcY,OACrB1B,EAAOqB,kBAAkBK,OACzB1B,EAAO2B,6BACP1B,EAAOqB,SAGRtB,EAAO4B,MAAQ,WACd5B,EAAOsB,QAEPtB,EAAOiB,YAAYY,OACnB7B,EAAOc,cAAce,OACrB7B,EAAOU,SAAU,EAEjBV,EAAOa,gBAAkBb,EAAO8B,iCAAiC,SAAUC,GAC1E/B,EAAOgC,UACPhC,EAAOa,gBAAkBkB,EACzB/B,EAAO2B,gCAIT3B,EAAOgC,QAAU,WAChB,IAAKhC,EAAOU,QAAZ,CAIA,IAAIuB,EAAY,CACfC,OAAQ,yCACRC,YAAanC,EAAOoB,eAAegB,MACnCC,OAAQrC,EAAOW,YACf2B,WAAYtC,EAAOY,WAGpBb,EAAEwC,KAAMC,QAASP,EAAWjC,EAAOyC,mBAGpCzC,EAAOyC,gBAAkB,SAAUC,GAClC,GAAOA,EAASC,UAAW3C,EAAOU,QAAlC,CAQA,IAAM,IAAIkC,KAJ4B,IAAjCF,EAASG,KAAKC,QAAQC,QAC1B/C,EAAOgD,WAGON,EAASG,KAAKC,QAAU,CACtC,IAAIG,EAASP,EAASG,KAAKC,QAAQF,GACnC5C,EAAOe,kBAAkBmC,QAASD,GAGnCjD,EAAOW,aAAeX,EAAOY,UAE7BZ,EAAOwB,mBACPxB,EAAOyB,oBAEPzB,EAAOgC,YAGRhC,EAAOgD,SAAW,WACjBhD,EAAOO,OACuB,EAAzBP,EAAOmD,gBACXnD,EAAOmB,OAAOU,OAEd7B,EAAOqB,kBAAkBQ,QAI3B7B,EAAOO,KAAO,WACbP,EAAOiB,YAAYS,OACnB1B,EAAOU,SAAU,GAGlBV,EAAOmD,cAAgB,WACtB,OAAOnD,EAAOe,kBAAkBT,KAAK,OAAOyC,QAG7C/C,EAAOwB,iBAAmB,WACzBzB,EAAE,6CAA6CqD,KAAMpD,EAAOmD,kBAG7DnD,EAAO2B,2BAA6B,WACnC5B,EAAE,sDAAsDqD,KAAMpD,EAAOa,kBAGtEb,EAAOyB,kBAAoB,WAC1BvB,EAAYC,OAAQJ,EAAE,oDAAqDC,EAAOqD,uBAGnFrD,EAAOqD,mBAAqB,WAC3B,GAAK,IAAMrD,EAAOW,aAAe,IAAMX,EAAOa,gBAC7C,OAAO,EAER,IAAIR,EAAWL,EAAOW,YAAcX,EAAOa,gBAE3C,OAAkB,KADlBR,EAAWiD,KAAKC,MAAkB,IAAXlD,IACC,IAAMA,GAG/BL,EAAO8B,iCAAmC,SAAU0B,GACnD,IAAIvB,EAAY,CACfC,OAAQ,gCACRC,YAAanC,EAAOoB,eAAegB,OAGpCrC,EAAEwC,KAAMC,QAASP,EAAW,SAAUS,GACrCe,QAAQC,IAAKhB,GAERA,EAASC,SACRa,GACJA,EAAUd,EAASG,KAAKd,UAQ5B/B,EAAOgB,aAAa2C,MAAM,WACzB3D,EAAO4B,UAGR5B,EAAOiB,YAAY0C,MAAM,WACxB3D,EAAOO,SAGRP,EAAOoB,eAAewC,OAAO,WAC5B5D,EAAOsB,QACPrB,EAAOqB,UAORrB,EAAOe,aAAejB,EAAE,uCACxBE,EAAO4D,kBAAoB,GAC3B5D,EAAO6D,gBAAkB,EAEzB7D,EAAO8D,YAAchE,EAAE,mCACvBE,EAAO+D,WAAajE,EAAE,kCAEtBE,EAAOqB,MAAQ,WACdrB,EAAOe,aAAaiD,KAAK,YAAY,GACrChE,EAAO6D,gBAAkB,EACzB7D,EAAO4D,kBAAoB,GAC3B5D,EAAO+D,WAAWtC,OAClBzB,EAAO8D,YAAYrC,OACnBzB,EAAOwB,qBAGRxB,EAAO2B,MAAQ,WACd3B,EAAOe,aAAaiD,KAAK,YAAY,GAErClE,EAAE,8CAA8CmE,KAAK,WACpDjE,EAAO4D,kBAAkBM,KAAMpE,EAAEqE,MAAMvB,KAAK,cAG7C5C,EAAO6D,gBAAkB7D,EAAO4D,kBAAkBd,OAElD9C,EAAOoE,mBAGRpE,EAAOoE,gBAAkB,WACxBpE,EAAOqE,kBACPrE,EAAO8D,YAAYlC,QAGpB5B,EAAOqE,gBAAkB,WAGnB,IAAMrE,EAAO4D,kBAAkBd,QACnC9C,EAAOsE,yBAGR,IAAIC,EAAQvE,EAAO4D,kBAAkBY,OAAQ,EAN5B,IAQjBxE,EAAOwB,oBAEP,IAAIQ,EAAY,CACfC,OAAQ,yCACRC,YAAanC,EAAOoB,eAAegB,MACnCoC,MAAOA,GAGRzE,EAAEwC,KAAMC,QAASP,EAAW,SAAUS,GAChCA,EAASC,UACb5C,EAAE,2CAA2CkE,KAAK,OAAQvB,EAASG,KAAK6B,WACxEzE,EAAOqE,sBAKVrE,EAAOoD,mBAAqB,WAC3B,GAAK,IAAMpD,EAAO6D,gBACjB,OAAO,EAER,IAAIzD,GAAaJ,EAAO6D,gBAAkB7D,EAAO4D,kBAAkBd,QAAW9C,EAAO6D,gBAErF,OAAkB,KADlBzD,EAAWiD,KAAKC,MAAkB,IAAXlD,IACC,IAAMA,GAI/BJ,EAAOwB,kBAAoB,WAC1BvB,EAAYC,OAAQJ,EAAE,kDAAmDE,EAAOoD,uBAGjFpD,EAAOsE,uBAAyB,WAC/BtE,EAAO+D,WAAWnC,QAGnB5B,EAAOe,aAAa2C,MAAM,WACzB1D,EAAO2B","file":"manual-workflow-runner.min.js","sourcesContent":["/**\n * AutomateWoo Workflows Runner\n */\n\njQuery(function($) {\n\n\tvar Finder = {};\n\tvar Runner = {};\n\tvar ProgressBar = {};\n\n\tProgressBar.update = function( $el, progress ) {\n\t\t$el.find('> .automatewoo-manual-runner-progress-bar__fill').stop().animate( {\n\t\t\twidth: progress + '%'\n\t\t}, progress === 0 ? 0 : 400 );\n\t};\n\n\tFinder.stopped = true;\n\tFinder.batchOffset = 0;\n\tFinder.batchSize = 15;\n\tFinder.possibleMatches = 0;\n\tFinder.$matchesTable = $('.automatewoo-manual-runner__matches-table');\n\tFinder.$resultsContainer = $('.automatewoo-manual-runner__matches-results');\n\tFinder.$startButton = $('.automatewoo-manual-runner__start-finder-btn');\n\tFinder.$stopButton = $('.automatewoo-manual-runner__stop-finder-btn');\n\tFinder.$step2 = $('.automatewoo-manual-runner__step-2');\n\tFinder.$step3 = $('.automatewoo-manual-runner__step-3');\n\tFinder.$workflowField = $('.automatewoo-manual-runner__workflow_field');\n\tFinder.$noMatchesMessage = $('.automatewoo-manual-runner__no-matches-message');\n\n\tFinder.reset = function() {\n\t\tFinder.stopped = true;\n\t\tFinder.batchOffset = 0;\n\t\tFinder.possibleMatches = 0;\n\t\tFinder.$resultsContainer.empty();\n\t\tFinder.updateFoundCount();\n\t\tFinder.updateProgressBar();\n\t\tFinder.$step3.hide();\n\t\tFinder.$matchesTable.hide();\n\t\tFinder.$noMatchesMessage.hide();\n\t\tFinder.updatePossibleMatchesCount();\n\t\tRunner.reset();\n\t};\n\n\tFinder.start = function() {\n\t\tFinder.reset();\n\n\t\tFinder.$stopButton.show();\n\t\tFinder.$matchesTable.show();\n\t\tFinder.stopped = false;\n\n\t\tFinder.possibleMatches = Finder.calculateQuickFilterResultsCount(function( count ){\n\t\t\tFinder.findSet();\n\t\t\tFinder.possibleMatches = count;\n\t\t\tFinder.updatePossibleMatchesCount();\n\t\t});\n\t};\n\n\tFinder.findSet = function() {\n\t\tif ( Finder.stopped ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar post_data = {\n\t\t\taction: 'aw_manual_workflow_runner_find_matches',\n\t\t\tworkflow_id: Finder.$workflowField.val(),\n\t\t\toffset: Finder.batchOffset,\n\t\t\tbatch_size: Finder.batchSize,\n\t\t};\n\n\t\t$.post( ajaxurl, post_data, Finder.findSetResponse );\n\t};\n\n\tFinder.findSetResponse = function( response ) {\n\t\tif ( ! response.success || Finder.stopped ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( response.data.results.length === 0 ) {\n\t\t\tFinder.complete();\n\t\t}\n\n\t\tfor ( var i in response.data.results ) {\n\t\t\tvar result = response.data.results[i];\n\t\t\tFinder.$resultsContainer.prepend( result );\n\t\t}\n\n\t\tFinder.batchOffset += Finder.batchSize;\n\n\t\tFinder.updateFoundCount();\n\t\tFinder.updateProgressBar();\n\n\t\tFinder.findSet();\n\t};\n\n\tFinder.complete = function() {\n\t\tFinder.stop();\n\t\tif ( Finder.getFoundCount() > 0 ) {\n\t\t\tFinder.$step3.show();\n\t\t} else {\n\t\t\tFinder.$noMatchesMessage.show();\n\t\t}\n\t};\n\n\tFinder.stop = function() {\n\t\tFinder.$stopButton.hide();\n\t\tFinder.stopped = true;\n\t};\n\n\tFinder.getFoundCount = function() {\n\t\treturn Finder.$resultsContainer.find('div').length;\n\t};\n\n\tFinder.updateFoundCount = function() {\n\t\t$('.automatewoo-manual-runner__matches-count').text( Finder.getFoundCount() );\n\t};\n\n\tFinder.updatePossibleMatchesCount = function() {\n\t\t$('.automatewoo-manual-runner__possible-matches-count').text( Finder.possibleMatches );\n\t};\n\n\tFinder.updateProgressBar = function() {\n\t\tProgressBar.update( $('.automatewoo-manual-runner__matches-progress-bar'), Finder.getCurrentProgress() );\n\t};\n\n\tFinder.getCurrentProgress = function() {\n\t\tif ( 0 === Finder.batchOffset || 0 === Finder.possibleMatches ) {\n\t\t\treturn 0;\n\t\t}\n\t\tvar progress = Finder.batchOffset / Finder.possibleMatches;\n\t\tprogress = Math.round( progress * 100 );\n\t\treturn progress > 100 ? 100 : progress;\n\t};\n\n\tFinder.calculateQuickFilterResultsCount = function( callback ) {\n\t\tvar post_data = {\n\t\t\taction: 'aw_count_quick_filter_matches',\n\t\t\tworkflow_id: Finder.$workflowField.val(),\n\t\t};\n\n\t\t$.post( ajaxurl, post_data, function( response ) {\n\t\t\tconsole.log( response );\n\n\t\t\tif ( response.success ) {\n\t\t\t\tif ( callback ) {\n\t\t\t\t\tcallback( response.data.count );\n\t\t\t\t}\n\t\t\t}\n\n\t\t} );\n\t};\n\n\n\tFinder.$startButton.click(function(){\n\t\tFinder.start();\n\t});\n\n\tFinder.$stopButton.click(function(){\n\t\tFinder.stop();\n\t});\n\n\tFinder.$workflowField.change(function() {\n\t\tFinder.reset();\n\t\tRunner.reset();\n\t});\n\n\n\t/**\n\t * Runner class\n\t */\n\tRunner.$startButton = $('.automatewoo-manual-runner__run-now');\n\tRunner.itemsToAddToQueue = [];\n\tRunner.itemsToAddCount = 0;\n\n\tRunner.$log_adding = $('.automatewoo-step-3-log__adding');\n\tRunner.$log_added = $('.automatewoo-step-3-log__added');\n\n\tRunner.reset = function() {\n\t\tRunner.$startButton.prop('disabled', false);\n\t\tRunner.itemsToAddCount = 0;\n\t\tRunner.itemsToAddToQueue = [];\n\t\tRunner.$log_added.hide();\n\t\tRunner.$log_adding.hide();\n\t\tRunner.updateProgressBar();\n\t};\n\n\tRunner.start = function() {\n\t\tRunner.$startButton.prop('disabled', true);\n\n\t\t$('.automatewoo-manual-runner__matches-result').each(function(){\n\t\t\tRunner.itemsToAddToQueue.push( $(this).data('item-id') );\n\t\t});\n\n\t\tRunner.itemsToAddCount = Runner.itemsToAddToQueue.length;\n\n\t\tRunner.startAddToQueue();\n\t};\n\n\tRunner.startAddToQueue = function() {\n\t\tRunner.addBatchToQueue();\n\t\tRunner.$log_adding.show();\n\t};\n\n\tRunner.addBatchToQueue = function() {\n\t\tvar batch_size = 10;\n\n\t\tif ( 0 === Runner.itemsToAddToQueue.length ) {\n\t\t\tRunner.completedAddingToQueue();\n\t\t}\n\n\t\tvar batch = Runner.itemsToAddToQueue.splice( 0, batch_size );\n\n\t\tRunner.updateProgressBar();\n\n\t\tvar post_data = {\n\t\t\taction: 'aw_manual_workflow_runner_add_to_queue',\n\t\t\tworkflow_id: Finder.$workflowField.val(),\n\t\t\tbatch: batch,\n\t\t};\n\n\t\t$.post( ajaxurl, post_data, function( response ) {\n\t\t\tif ( response.success ) {\n\t\t\t\t$('.automatewoo-step-3-log__view-queue-url').prop('href', response.data.queue_url );\n\t\t\t\tRunner.addBatchToQueue();\n\t\t\t}\n\t\t} );\n\t};\n\n\tRunner.getCurrentProgress = function() {\n\t\tif ( 0 === Runner.itemsToAddCount ) {\n\t\t\treturn 0;\n\t\t}\n\t\tvar progress = ( Runner.itemsToAddCount - Runner.itemsToAddToQueue.length ) / Runner.itemsToAddCount;\n\t\tprogress = Math.round( progress * 100 );\n\t\treturn progress > 100 ? 100 : progress;\n\t};\n\n\n\tRunner.updateProgressBar = function() {\n\t\tProgressBar.update( $('.automatewoo-manual-runner__queue-progress-bar'), Runner.getCurrentProgress() );\n\t};\n\n\tRunner.completedAddingToQueue = function() {\n\t\tRunner.$log_added.show();\n\t};\n\n\tRunner.$startButton.click(function(){\n\t\tRunner.start();\n\t});\n\n});"]}