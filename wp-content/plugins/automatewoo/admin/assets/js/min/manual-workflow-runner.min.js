jQuery(function(o){var a={},u={},t={update:function(t,e){t.find("> .automatewoo-manual-runner-progress-bar__fill").stop().animate({width:e+"%"},0===e?0:400)}};a.stopped=!0,a.batchOffset=0,a.batchSize=15,a.possibleMatches=0,a.$matchesTable=o(".automatewoo-manual-runner__matches-table"),a.$resultsContainer=o(".automatewoo-manual-runner__matches-results"),a.$startButton=o(".automatewoo-manual-runner__start-finder-btn"),a.$stopButton=o(".automatewoo-manual-runner__stop-finder-btn"),a.$step2=o(".automatewoo-manual-runner__step-2"),a.$step3=o(".automatewoo-manual-runner__step-3"),a.$workflowField=o(".automatewoo-manual-runner__workflow_field"),a.$noMatchesMessage=o(".automatewoo-manual-runner__no-matches-message"),a.reset=function(){a.stopped=!0,a.batchOffset=0,a.possibleMatches=0,a.$resultsContainer.empty(),a.updateFoundCount(),a.updateProgressBar(),a.$step3.hide(),a.$matchesTable.hide(),a.$noMatchesMessage.hide(),a.updatePossibleMatchesCount(),u.reset()},a.start=function(){a.reset(),a.$stopButton.show(),a.$matchesTable.show(),a.stopped=!1,a.possibleMatches=a.calculateQuickFilterResultsCount(function(t){a.findSet(),a.possibleMatches=t,a.updatePossibleMatchesCount()})},a.findSet=function(){if(!a.stopped){var t={action:"aw_manual_workflow_runner_find_matches",workflow_id:a.$workflowField.val(),offset:a.batchOffset,batch_size:a.batchSize};o.post(ajaxurl,t,a.findSetResponse)}},a.findSetResponse=function(t){if(t.success&&!a.stopped){for(var e in 0===t.data.results.length&&a.complete(),t.data.results){var o=t.data.results[e];a.$resultsContainer.prepend(o)}a.batchOffset+=a.batchSize,a.updateFoundCount(),a.updateProgressBar(),a.findSet()}},a.complete=function(){a.stop(),0<a.getFoundCount()?a.$step3.show():a.$noMatchesMessage.show()},a.stop=function(){a.$stopButton.hide(),a.stopped=!0},a.getFoundCount=function(){return a.$resultsContainer.find("div").length},a.updateFoundCount=function(){o(".automatewoo-manual-runner__matches-count").text(a.getFoundCount())},a.updatePossibleMatchesCount=function(){o(".automatewoo-manual-runner__possible-matches-count").text(a.possibleMatches)},a.updateProgressBar=function(){t.update(o(".automatewoo-manual-runner__matches-progress-bar"),a.getCurrentProgress())},a.getCurrentProgress=function(){if(0===a.batchOffset||0===a.possibleMatches)return 0;var t=a.batchOffset/a.possibleMatches;return 100<(t=Math.round(100*t))?100:t},a.calculateQuickFilterResultsCount=function(e){var t={action:"aw_count_quick_filter_matches",workflow_id:a.$workflowField.val()};o.post(ajaxurl,t,function(t){console.log(t),t.success&&e&&e(t.data.count)})},a.$startButton.click(function(){a.start()}),a.$stopButton.click(function(){a.stop()}),a.$workflowField.change(function(){a.reset(),u.reset()}),u.$startButton=o(".automatewoo-manual-runner__run-now"),u.itemsToAddToQueue=[],u.itemsToAddCount=0,u.$log_adding=o(".automatewoo-step-3-log__adding"),u.$log_added=o(".automatewoo-step-3-log__added"),u.reset=function(){u.$startButton.prop("disabled",!1),u.itemsToAddCount=0,u.itemsToAddToQueue=[],u.$log_added.hide(),u.$log_adding.hide(),u.updateProgressBar()},u.start=function(){u.$startButton.prop("disabled",!0),o(".automatewoo-manual-runner__matches-result").each(function(){u.itemsToAddToQueue.push(o(this).data("item-id"))}),u.itemsToAddCount=u.itemsToAddToQueue.length,u.startAddToQueue()},u.startAddToQueue=function(){u.addBatchToQueue(),u.$log_adding.show()},u.addBatchToQueue=function(){0===u.itemsToAddToQueue.length&&u.completedAddingToQueue();var t=u.itemsToAddToQueue.splice(0,10);u.updateProgressBar();var e={action:"aw_manual_workflow_runner_add_to_queue",workflow_id:a.$workflowField.val(),batch:t};o.post(ajaxurl,e,function(t){t.success&&(o(".automatewoo-step-3-log__view-queue-url").prop("href",t.data.queue_url),u.addBatchToQueue())})},u.getCurrentProgress=function(){if(0===u.itemsToAddCount)return 0;var t=(u.itemsToAddCount-u.itemsToAddToQueue.length)/u.itemsToAddCount;return 100<(t=Math.round(100*t))?100:t},u.updateProgressBar=function(){t.update(o(".automatewoo-manual-runner__queue-progress-bar"),u.getCurrentProgress())},u.completedAddingToQueue=function(){u.$log_added.show()},u.$startButton.click(function(){u.start()})});
//# sourceMappingURL=manual-workflow-runner.min.js.map
