jQuery(function(i){if("undefined"==typeof wc_price_based_country_frontend_params)return!1;var t={supports_html5_storage:!0,set_cart_creation_timestamp:function(){this.supports_html5_storage&&sessionStorage.setItem("wc_cart_created",(new Date).getTime())},set_cart_hash:function(e){this.supports_html5_storage&&(localStorage.setItem(wc_cart_fragments_params.cart_hash_key,e),sessionStorage.setItem(wc_cart_fragments_params.cart_hash_key,e))},refresh_cart:function(){i.ajax({url:wc_price_based_country_frontend_params.wc_ajax_url.toString().replace("%%endpoint%%","get_refreshed_fragments"),type:"POST",success:function(e){e&&e.fragments&&(i.each(e.fragments,function(e,r){i(e).replaceWith(r)}),t.supports_html5_storage&&(sessionStorage.setItem(wc_cart_fragments_params.fragment_name,JSON.stringify(e.fragments)),t.set_cart_hash(e.cart_hash),e.cart_hash&&t.set_cart_creation_timestamp()))}})},set_refresh_cart_flag:function(){"undefined"==typeof Cookies?i.cookie("wc_pbc_refresh_cart","1"):Cookies.set("wc_pbc_refresh_cart","1")},get_refresh_cart_flag:function(){if("undefined"==typeof Cookies)var e=i.cookie("wc_pbc_refresh_cart");else e=Cookies.get("wc_pbc_refresh_cart");return e},remove_refresh_cart_flag:function(){"undefined"==typeof Cookies?i.removeCookie("wc_pbc_refresh_cart"):Cookies.remove("wc_pbc_refresh_cart")},maybe_refresh_cart:function(){void 0!==this.get_refresh_cart_flag()&&(this.remove_refresh_cart_flag(),this.refresh_cart())},init:function(){if("undefined"==typeof wc_cart_fragments_params)return!1;try{this.supports_html5_storage="sessionStorage"in window&&null!==window.sessionStorage,window.sessionStorage.setItem("wcpbc","test"),window.sessionStorage.removeItem("wcpbc"),window.localStorage.setItem("wcpbc","test"),window.localStorage.removeItem("wcpbc")}catch(e){this.supports_html5_storage=!1}this.maybe_refresh_cart(),i("form[class ^= wcpbc-widget]").on("submit",function(e){0<i("form.woocommerce-checkout").length||t.set_refresh_cart_flag()}),i(document.body).on("updated_checkout",function(e,r){t.refresh_cart()})}};t.init();var a={xhr:!1,get_product_ids:function(){var t=[],r=null,e=i("form.variations_form").data("product_variations");return i("span.wcpbc-price.loading").each(function(){if(void 0===(r=i(this).data("productId"))){var e=i(this).attr("class").match(/wcpbc-price-\d+/);null!=e&&0<e.length&&(r=parseInt(e[0].replace("wcpbc-price-","")))}r&&void 0!==r&&t.push(r)}),null!=e&&i.each(e,function(e,r){void 0!==r.variation_id&&t.push(r.variation_id)}),i(document.body).trigger("wc_price_based_country_get_product_ids",[t]),t.sort(),t},get_areas:function(){var o={};return i(".wc-price-based-country-refresh-area").each(function(e,r){var t=i(r).data("area"),a=i(r).data("id"),c=i(r).data("options");void 0!==t&&void 0!==a&&void 0!==c&&(void 0===o[t]&&(o[t]={}),o[t][a]=c)}),o},refresh_product_price:function(a){var t;i.each(a,function(e,r){void 0!==(t=i("<div>"+r.price_html+"</div>").find(".wcpbc-price.wcpbc-price-"+r.id+":first"))&&i(".wcpbc-price.wcpbc-price-"+r.id).html(t.html()).removeClass("loading")});var c=i("form.variations_form").data("product_variations");null!=c&&(i.each(c,function(e,r){var t=i(r.price_html);void 0!==a[r.variation_id]&&(c[e].display_price=a[r.variation_id].display_price,c[e].display_regular_price=a[r.variation_id].display_regular_price,t.hasClass("price")?t.first().html(a[r.variation_id].price_html):t.html(a[r.variation_id].price_html)),t.find(".wcpbc-price").css("visibility",""),t.find(".wcpbc-price").removeClass("loading"),c[e].price_html=t.html()}),i("form.variations_form").data("product_variations",c)),i(document.body).trigger("wc_price_based_country_set_product_price",[a]),i(".wcpbc-price").css("visibility",""),i(".wcpbc-price").css("display",""),i(".wcpbc-price").removeClass("loading")},refresh_areas:function(e){i.each(e,function(e,r){var t='.wc-price-based-country-refresh-area[data-id="'+r.id+'"][data-area="'+r.area+'"]',a=i(r.content).filter('.wc-price-based-country-refresh-area[data-area="'+r.area+'"]').html();i(t).html(a)})},refresh_currency_settings:function(e){if("undefined"!=typeof woocommerce_price_slider_params&&"undefined"!=typeof accounting){var r=i(".price_slider_amount #min_price").data("min"),t=i(".price_slider_amount #max_price").data("max");i(".price_slider_amount span.from").html(accounting.formatMoney(r,{symbol:e.symbol,decimal:e.decimal_sep,thousand:e.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:e.format})),i(".price_slider_amount span.to").html(accounting.formatMoney(t,{symbol:e.symbol,decimal:e.decimal_sep,thousand:e.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:e.format})),woocommerce_price_slider_params.currency_format_symbol=e.symbol,woocommerce_price_slider_params.currency_format_decimal_sep=e.decimal_sep,woocommerce_price_slider_params.currency_format_thousand_sep=e.thousand_sep,woocommerce_price_slider_params.currency_format=e.format}i(document.body).trigger("wc_price_based_country_set_currency_params",[e])},geolocate_customer:function(){a.xhr&&a.xhr.abort();var e={ids:a.get_product_ids(),areas:a.get_areas(),is_single:i("body").hasClass("single")?"1":"0"};a.xhr=i.ajax({url:wc_price_based_country_frontend_params.wc_ajax_url.toString().replace("%%endpoint%%","wcpbc_get_location"),data:e,type:"POST",success:function(e){a.refresh_product_price(e.products),a.refresh_areas(e.areas),a.refresh_currency_settings(e.currency_params),i(document.body).trigger("wc_price_based_country_after_ajax_geolocation",[e.zone_id])},complete:function(){a.xhr=!1}})},init:function(){"1"===wc_price_based_country_frontend_params.ajax_geolocation&&(this.geolocate_customer(),i(document).ajaxComplete(function(e,r,t){if(0==i("body").find(".wcpbc-price.loading").length||0<t.url.indexOf("wcpbc_get_location")||0<t.url.indexOf("get_refreshed_fragments"))return!1;void 0!==r.responseText&&0<r.responseText.indexOf("wcpbc-price")&&a.geolocate_customer()}))}};a.init()});